\chapter{Simple Reasoning}

Introduction to reasoning about a function in a forwards or backwards direction.  For forwards direction, need a staged approach where we eventually introduce the concept of a skolem.  Cover control-flow constructs upto, but not including loops.  This includes if-conditions, switch statements, function calls, array assignments, reference assignments, etc.  Also, introduce basic concept of a weakest precondition versus a strongest postcondition.  Introduce control-flow graph 
and the path sensitive traversal?

\section{Functions}

Begin with pre / post-conditions and return statements.

\section{Assignments}

Examine assignments.

\section{Conditionals}
Examine simple examples involving conditions, such as \lstinline{abs()} and \lstinline{max()}

\section{Function Calls}
Examine involving function calls

\section{Compound Data Types}
Examine examples with updating lists, records, etc.

\section{Complex Reasoning}
Examine problem with our simplistic way of thinking about assignments.

\section{Forwards versus Backward Reasoning}
Discuss the so-called weakest precondition transformer.

\section{Exercises}

\begin{ex}
The function \lstinline{neg()} returns the arithmetic negation of a value.
For example, \lstinline{neg(1) = -1}.  An implementation of
this function is given as follows:
\begin{lstlisting}
function neg(int x) => (int r):
    return -x
\end{lstlisting}
Provide an appropriate {\em post-condition} for this function.
\end{ex}

\begin{ex}
The \lstinline{swap} function accepts to integers and returns them
with their order swapped.  The signature for the function is:
\begin{lstlisting}
function swap(int x, int y) => (int a, int b):
    ...
\end{lstlisting}
Provide an appropriate specification and implementation for this function.
\end{ex}

\begin{ex}

\subsection{Sum Over Naturals}
A {\em natural} number is an integer which is greater-than-or-equal to
zero.  The following function adds three natural numbers together to produce a natural number:
\begin{lstlisting}
function sum3(int x, int y, int z) => (int r)
// No parameter can be negative
requires ...
// Return value cannot be negative
ensures ...:
    //
    return x + y + z
\end{lstlisting}
Complete the given \lstinline{requires} and \lstinline{ensures}
clauses based on the given English descriptions.
\end{enumerate}
\end{ex}

\begin{ex}
  The following function computes the absolute difference between two values:

\begin{lstlisting}
function diff(int x, int y) => (int r):
    //
    if x > y:
        return x - y
    else:
        return y - x
\end{lstlisting}

A {\em pre-condition} of this function is that parameter \lstinline{x}
is between \lstinline{0} and \lstinline{255} (inclusive) and,
likewise, that variable \lstinline{y} is between \lstinline{-128} and
\lstinline{127} (inclusive).  Provide a partial specification for
this function which constraints the ranges of the input and output
variables as tightly as possible.
\end{ex}

\begin{ex}
The Gregorian calendar is the most widely used organisation of dates.
A well-known saying for remembering the number of days in each month
is the following:
\begin{quote}
``Thirty days hath September, April, June and November.  All the rest
have thirty-one, except February which has twenty-nine ...''
\end{quote}
Note, in this exercise, we will ignore the issue of leap years.  A
simple function for returning a date can be defined as follws:
\begin{lstlisting}
constant Jan is 1
constant Feb is 2
constant Mar is 3
constant Apr is 4
constant May is 5
constant Jun is 6
constant Jul is 7
constant Aug is 8
constant Sep is 9
constant Oct is 10
constant Nov is 11
constant Dec is 12

function getDate() => (int day, int month, int year):
    ...
\end{lstlisting}
Provide a specification for this function to ensure the returned date
is valid (ignoring leap years).  Furthermore, provide a simple
implementation which meets this specification.
\end{ex}

\begin{ex}
A well-known puzzle is that of the three water jugs.  In this
exercise, we will consider a cut down version of this which consists
of two water jugs: a small jug (containing three litres) and a large
jug (containing five litres).  The goal is to complete the
specification of the following function for pouring water from the
small jug into the large jug:

\begin{lstlisting}
function pourSmall2Large(int smallJug, int largeJug) => 
                        (int smallJugAfter, int largeJugAfter)
// The small jug holds between 0 and 3 litres (before)
requires ...
// The large jug holds between 0 and 5 litres (before)
requires ...
// The small jug holds between 0 and 3 litres (after)
ensures ...
// The large jug holds between 0 and 5 litres (after)
ensures ...
// The amount in both jugs is unchanged by this function
ensures ...
// Afterwards, either the small jug is empty or the large jug is full
ensures ...:
    //
    if smallJug + largeJug <= 5:
        // indicates we're emptying the small jug
        largeJug = largeJug + smallJug
        smallJug = 0
    else:
        // indicates we're filling up the medium jug    
        smallJug = largeJug + smallJug
        largeJug = 5
    // Done
    return smallJug, largeJug
\end{lstlisting}
Complete the missing \lstinline{requires} and \lstinline{ensures}
clauses based on the given English descriptions.  Does the implementation meet the given specification?
\end{ex}

